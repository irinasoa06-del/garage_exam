"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[1840],{1840:(b,g,u)=>{u.r(g),u.d(g,{CarAddPageModule:()=>A});var m=u(6895),a=u(433),i=u(12),p=u(5861),y=u(506),v=u(3295),e=u(8256),f=u(2687);function h(o,d){if(1&o){const t=e.EpF();e.TgZ(0,"ion-item")(1,"ion-label")(2,"h3"),e._uU(3),e.qZA(),e.TgZ(4,"p"),e._uU(5),e.qZA(),e.TgZ(6,"p",16),e._uU(7),e.qZA()(),e.TgZ(8,"ion-badge",17),e._uU(9),e.qZA(),e.TgZ(10,"ion-button",18),e.NdJ("click",function(){const r=e.CHM(t).index,s=e.oxw();return e.KtG(s.supprimerIntervention(r))}),e._UZ(11,"ion-icon",19),e.qZA()()}if(2&o){const t=d.$implicit,n=e.oxw();e.xp6(3),e.Oqu(t.type.nom),e.xp6(2),e.Oqu(t.description),e.xp6(2),e.hij("Prix: ",t.type.prix_unitaire," Ar"),e.xp6(1),e.Q6J("color",n.getPrioriteColor(t.priorite)),e.xp6(1),e.hij(" ",t.priorite," ")}}function _(o,d){1&o&&(e.TgZ(0,"ion-item")(1,"ion-label",20)(2,"p"),e._uU(3,"Aucune panne ajout\xe9e"),e.qZA(),e.TgZ(4,"p"),e._uU(5,"Cliquez sur + pour ajouter une panne"),e.qZA()()())}function Z(o,d){if(1&o&&(e.TgZ(0,"ion-card")(1,"ion-card-header")(2,"ion-card-title"),e._uU(3,"Estimation"),e.qZA()(),e.TgZ(4,"ion-card-content")(5,"div",21)(6,"span"),e._uU(7,"Co\xfbt total estim\xe9:"),e.qZA(),e.TgZ(8,"span",22),e._uU(9),e.qZA()()()()),2&o){const t=e.oxw();e.xp6(9),e.hij(" ",t.getTotalEstime()," Ar ")}}const C=[{path:"",component:(()=>{class o{constructor(t,n,l,r,s,c){this.formBuilder=t,this.voitureService=n,this.reparationService=l,this.router=r,this.loadingController=s,this.alertController=c,this.typesIntervention=[],this.selectedInterventions=[],this.carForm=this.formBuilder.group({immatriculation:["",[a.kI.required,a.kI.pattern(/^[A-Z0-9-]+$/)]],marque:["",[a.kI.required,a.kI.minLength(2)]],modele:["",[a.kI.required,a.kI.minLength(2)]],annee:["",[a.kI.min(1900),a.kI.max((new Date).getFullYear())]],couleur:[""]})}ngOnInit(){this.loadTypesIntervention()}loadTypesIntervention(){var t=this;return(0,p.Z)(function*(){const n=yield t.loadingController.create({message:"Chargement des types de r\xe9paration..."});var l;yield n.present(),t.reparationService.getTypesIntervention().subscribe({next:l=>{t.typesIntervention=l,n.dismiss()},error:(l=(0,p.Z)(function*(r){n.dismiss(),yield(yield t.alertController.create({header:"Erreur",message:"Impossible de charger les types de r\xe9paration",buttons:["OK"]})).present()}),function(s){return l.apply(this,arguments)})})})()}ajouterIntervention(){var t=this;return(0,p.Z)(function*(){const n=yield t.alertController.create({header:"Ajouter une panne",inputs:[{name:"type_id",type:"number",placeholder:"S\xe9lectionner le type",min:1,max:t.typesIntervention.length},{name:"description",type:"textarea",placeholder:"D\xe9crire la panne..."},{name:"priorite",type:"text",value:"moyen",placeholder:"Priorit\xe9 (faible/moyen/eleve)"}],buttons:[{text:"Annuler",role:"cancel"},{text:"Ajouter",handler:r=>{if(r.type_id&&r.description){const s=t.typesIntervention.find(c=>c.type_id===parseInt(r.type_id));s&&t.selectedInterventions.push({type:s,description:r.description,priorite:r.priorite||"moyen"})}}}]});let l="Types disponibles:\n";t.typesIntervention.forEach(r=>{l+=`${r.type_id}. ${r.nom} (${r.prix_unitaire} Ar)\n`}),n.message=l,yield n.present()})()}supprimerIntervention(t){this.selectedInterventions.splice(t,1)}getPrioriteColor(t){switch(t){case"faible":return"success";case"moyen":return"warning";case"eleve":return"danger";default:return"medium"}}getTotalEstime(){return this.selectedInterventions.reduce((t,n)=>t+n.type.prix_unitaire,0)}soumettre(){var t=this;return(0,p.Z)(function*(){if(t.carForm.invalid)return void(yield(yield t.alertController.create({header:"Formulaire invalide",message:"Veuillez remplir tous les champs obligatoires",buttons:["OK"]})).present());if(0===t.selectedInterventions.length)return void(yield(yield t.alertController.create({header:"Aucune panne",message:"Veuillez ajouter au moins une panne \xe0 r\xe9parer",buttons:["OK"]})).present());const n=yield t.loadingController.create({message:"Enregistrement..."});yield n.present();const l=Object.assign(Object.assign({},t.carForm.value),{interventions:t.selectedInterventions.map(r=>({type_id:r.type.type_id,description_panne:r.description,priorite:r.priorite}))});var r;t.voitureService.ajouterVoiture(l).subscribe({next:(r=(0,p.Z)(function*(s){yield n.dismiss(),yield(yield t.alertController.create({header:"Succ\xe8s",message:"Votre voiture a \xe9t\xe9 ajout\xe9e avec succ\xe8s",buttons:["OK"]})).present(),t.router.navigate(["/cars"])}),function(c){return r.apply(this,arguments)}),error:function(){var r=(0,p.Z)(function*(s){var c;yield n.dismiss(),yield(yield t.alertController.create({header:"Erreur",message:(null===(c=s.error)||void 0===c?void 0:c.message)||"Impossible d'ajouter la voiture",buttons:["OK"]})).present()});return function(c){return r.apply(this,arguments)}}()})})()}annuler(){this.router.navigate(["/cars"])}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(a.qu),e.Y36(y.E),e.Y36(v.L),e.Y36(f.F0),e.Y36(i.HT),e.Y36(i.Br))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-car-add"]],decls:36,vars:4,consts:[["slot","start"],["defaultHref","/cars"],[1,"ion-padding"],[3,"formGroup"],["label","Immatriculation *","label-placement","floating","type","text","formControlName","immatriculation","required",""],["label","Marque *","label-placement","floating","type","text","formControlName","marque","required",""],["label","Mod\xe8le *","label-placement","floating","type","text","formControlName","modele","required",""],["label","Ann\xe9e","label-placement","floating","type","number","formControlName","annee"],["label","Couleur","label-placement","floating","type","text","formControlName","couleur"],["fill","clear",3,"click"],["slot","icon-only","name","add-circle"],[4,"ngFor","ngForOf"],[4,"ngIf"],[1,"buttons-container"],["expand","block","fill","outline",3,"click"],["expand","block",3,"click"],[1,"price"],["slot","end",3,"color"],["fill","clear","slot","end",3,"click"],["slot","icon-only","name","trash","color","danger"],["color","medium",1,"ion-text-center"],[1,"total-estimation"],[1,"amount"]],template:function(t,n){1&t&&(e.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),e._UZ(3,"ion-back-button",1),e.qZA(),e.TgZ(4,"ion-title"),e._uU(5,"Ajouter une voiture"),e.qZA()()(),e.TgZ(6,"ion-content",2)(7,"form",3)(8,"ion-list")(9,"ion-list-header")(10,"ion-label"),e._uU(11,"Informations du v\xe9hicule"),e.qZA()(),e.TgZ(12,"ion-item"),e._UZ(13,"ion-input",4),e.qZA(),e.TgZ(14,"ion-item"),e._UZ(15,"ion-input",5),e.qZA(),e.TgZ(16,"ion-item"),e._UZ(17,"ion-input",6),e.qZA(),e.TgZ(18,"ion-item"),e._UZ(19,"ion-input",7),e.qZA(),e.TgZ(20,"ion-item"),e._UZ(21,"ion-input",8),e.qZA()(),e.TgZ(22,"ion-list")(23,"ion-list-header")(24,"ion-label"),e._uU(25,"Pannes \xe0 r\xe9parer"),e.qZA(),e.TgZ(26,"ion-button",9),e.NdJ("click",function(){return n.ajouterIntervention()}),e._UZ(27,"ion-icon",10),e.qZA()(),e.YNc(28,h,12,5,"ion-item",11),e.YNc(29,_,6,0,"ion-item",12),e.qZA(),e.YNc(30,Z,10,1,"ion-card",12),e.TgZ(31,"div",13)(32,"ion-button",14),e.NdJ("click",function(){return n.annuler()}),e._uU(33," Annuler "),e.qZA(),e.TgZ(34,"ion-button",15),e.NdJ("click",function(){return n.soumettre()}),e._uU(35," Enregistrer "),e.qZA()()()()),2&t&&(e.xp6(7),e.Q6J("formGroup",n.carForm),e.xp6(21),e.Q6J("ngForOf",n.selectedInterventions),e.xp6(1),e.Q6J("ngIf",0===n.selectedInterventions.length),e.xp6(1),e.Q6J("ngIf",n.selectedInterventions.length>0))},dependencies:[m.sg,m.O5,a._Y,a.JJ,a.JL,a.Q7,a.sg,a.u,i.yp,i.YG,i.Sm,i.PM,i.FN,i.Zi,i.Dq,i.W2,i.Gu,i.gu,i.pK,i.Ie,i.Q$,i.q_,i.yh,i.wd,i.sr,i.as,i.j9,i.oU],styles:["ion-list-header[_ngcontent-%COMP%]{padding-top:20px}ion-list-header[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{font-size:18px;font-weight:600}ion-item[_ngcontent-%COMP%]{margin-bottom:10px}ion-item[_ngcontent-%COMP%]   .price[_ngcontent-%COMP%]{color:var(--ion-color-primary);font-weight:600;margin-top:4px}.total-estimation[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;font-size:18px;font-weight:600}.total-estimation[_ngcontent-%COMP%]   .amount[_ngcontent-%COMP%]{color:var(--ion-color-primary);font-size:24px}.buttons-container[_ngcontent-%COMP%]{margin-top:24px;display:flex;gap:12px}.buttons-container[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{flex:1}"]}),o})()}];let A=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[m.ez,a.u5,a.UX,i.Pc,f.Bz.forChild(C)]}),o})()}}]);