"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[6699],{6699:(O,d,l)=>{l.r(d),l.d(d,{NotificationsPageModule:()=>M});var g=l(6895),m=l(433),a=l(12),u=l(5861),h=l(5384),t=l(8256);let N=(()=>{class n{constructor(e){this.api=e}getMesNotifications(){return this.api.get("notifications")}getNotificationsNonLues(){return this.api.get("notifications",{lue:!1})}marquerCommeLue(e){return this.api.patch(`notifications/${e}`,{lue:!0})}marquerToutCommeLu(){return this.api.post("notifications/mark-all-read",{})}enregistrerTokenFCM(e){return this.api.post("notifications/register-token",{fcm_token:e})}supprimerNotification(e){return this.api.delete(`notifications/${e}`)}}return n.\u0275fac=function(e){return new(e||n)(t.LFG(h.s))},n.\u0275prov=t.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var _=l(2687);function x(n,s){if(1&n){const e=t.EpF();t.TgZ(0,"ion-button",10),t.NdJ("click",function(){t.CHM(e);const o=t.oxw();return t.KtG(o.marquerToutCommeLu())}),t._UZ(1,"ion-icon",11),t.qZA()}}function v(n,s){1&n&&(t.TgZ(0,"ion-badge",20),t._uU(1," Nouveau "),t.qZA())}function C(n,s){if(1&n){const e=t.EpF();t.TgZ(0,"ion-item-sliding")(1,"ion-item",13),t.NdJ("click",function(){const r=t.CHM(e).$implicit,c=t.oxw(2);return t.KtG(c.marquerCommeLue(r))}),t.TgZ(2,"ion-avatar",0),t._UZ(3,"ion-icon",14),t.qZA(),t.TgZ(4,"ion-label")(5,"h2"),t._uU(6),t.qZA(),t.TgZ(7,"p"),t._uU(8),t.qZA(),t.TgZ(9,"p",15),t._uU(10),t.qZA()(),t.YNc(11,v,2,0,"ion-badge",16),t.qZA(),t.TgZ(12,"ion-item-options",17)(13,"ion-item-option",18),t.NdJ("click",function(o){const c=t.CHM(e).$implicit,f=t.oxw(2);return t.KtG(f.supprimerNotification(c,o))}),t._UZ(14,"ion-icon",19),t.qZA()()()}if(2&n){const e=s.$implicit,i=t.oxw(2);t.xp6(1),t.ekj("unread",!e.lue),t.xp6(2),t.Q6J("name",i.getTypeIcon(e.type))("color",i.getTypeColor(e.type)),t.xp6(3),t.Oqu(e.titre),t.xp6(2),t.Oqu(e.message),t.xp6(2),t.Oqu(i.formatDate(e.date_envoi)),t.xp6(1),t.Q6J("ngIf",!e.lue)}}function T(n,s){if(1&n&&(t.TgZ(0,"ion-list"),t.YNc(1,C,15,8,"ion-item-sliding",12),t.qZA()),2&n){const e=t.oxw();t.xp6(1),t.Q6J("ngForOf",e.filteredNotifications)}}function Z(n,s){1&n&&(t.TgZ(0,"p"),t._uU(1,"Vous n'avez pas encore de notifications"),t.qZA())}function y(n,s){1&n&&(t.TgZ(0,"p"),t._uU(1,"Toutes vos notifications ont \xe9t\xe9 lues"),t.qZA())}function b(n,s){if(1&n&&(t.TgZ(0,"div",21),t._UZ(1,"ion-icon",22),t.TgZ(2,"h2"),t._uU(3,"Aucune notification"),t.qZA(),t.YNc(4,Z,2,0,"p",8),t.YNc(5,y,2,0,"p",8),t.qZA()),2&n){const e=t.oxw();t.xp6(4),t.Q6J("ngIf","all"===e.selectedFilter),t.xp6(1),t.Q6J("ngIf","non_lues"===e.selectedFilter)}}const P=[{path:"",component:(()=>{class n{constructor(e,i,o,r){this.notificationService=e,this.router=i,this.loadingController=o,this.alertController=r,this.notifications=[],this.selectedFilter="all"}ngOnInit(){this.loadNotifications()}ionViewWillEnter(){this.loadNotifications()}loadNotifications(){var e=this;return(0,u.Z)(function*(){const i=yield e.loadingController.create({message:"Chargement..."});var o;yield i.present(),e.notificationService.getMesNotifications().subscribe({next:o=>{e.notifications=o.sort((r,c)=>new Date(c.date_envoi).getTime()-new Date(r.date_envoi).getTime()),i.dismiss()},error:(o=(0,u.Z)(function*(r){i.dismiss(),yield(yield e.alertController.create({header:"Erreur",message:"Impossible de charger les notifications",buttons:["OK"]})).present()}),function(c){return o.apply(this,arguments)})})})()}get filteredNotifications(){return"non_lues"===this.selectedFilter?this.notifications.filter(e=>!e.lue):this.notifications}get nombreNonLues(){return this.notifications.filter(e=>!e.lue).length}filterChanged(e){this.selectedFilter=e.detail.value}getTypeIcon(e){switch(e){case"reparation_prete":return"checkmark-circle";case"paiement":return"card";case"mise_a_jour":return"information-circle";default:return"notifications"}}getTypeColor(e){switch(e){case"reparation_prete":return"success";case"paiement":return"warning";case"mise_a_jour":return"primary";default:return"medium"}}formatDate(e){const i=new Date(e),r=(new Date).getTime()-i.getTime(),c=Math.floor(r/6e4),f=Math.floor(r/36e5),p=Math.floor(r/864e5);return c<60?`Il y a ${c} min`:f<24?`Il y a ${f}h`:1===p?"Hier":p<7?`Il y a ${p} jours`:i.toLocaleDateString("fr-FR")}marquerCommeLue(e){var i=this;return(0,u.Z)(function*(){e.lue||i.notificationService.marquerCommeLue(e.notification_id).subscribe({next:()=>{e.lue=!0},error:o=>{console.error("Erreur marquer comme lue:",o)}})})()}marquerToutCommeLu(){var e=this;return(0,u.Z)(function*(){const i=yield e.loadingController.create({message:"Traitement..."});var o;yield i.present(),e.notificationService.marquerToutCommeLu().subscribe({next:()=>{e.notifications.forEach(o=>o.lue=!0),i.dismiss()},error:(o=(0,u.Z)(function*(r){i.dismiss(),yield(yield e.alertController.create({header:"Erreur",message:"Impossible de marquer toutes les notifications",buttons:["OK"]})).present()}),function(c){return o.apply(this,arguments)})})})()}supprimerNotification(e,i){var o=this;return(0,u.Z)(function*(){i.stopPropagation(),yield(yield o.alertController.create({header:"Supprimer",message:"Voulez-vous supprimer cette notification ?",buttons:[{text:"Annuler",role:"cancel"},{text:"Supprimer",role:"destructive",handler:()=>{o.confirmerSuppression(e.notification_id)}}]})).present()})()}confirmerSuppression(e){var i=this;return(0,u.Z)(function*(){var o;i.notificationService.supprimerNotification(e).subscribe({next:()=>{i.notifications=i.notifications.filter(o=>o.notification_id!==e)},error:(o=(0,u.Z)(function*(r){yield(yield i.alertController.create({header:"Erreur",message:"Impossible de supprimer la notification",buttons:["OK"]})).present()}),function(c){return o.apply(this,arguments)})})})()}doRefresh(e){this.notificationService.getMesNotifications().subscribe({next:i=>{this.notifications=i.sort((o,r)=>new Date(r.date_envoi).getTime()-new Date(o.date_envoi).getTime()),e.target.complete()},error:()=>{e.target.complete()}})}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(N),t.Y36(_.F0),t.Y36(a.HT),t.Y36(a.Br))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-notifications"]],decls:21,vars:5,consts:[["slot","start"],["defaultHref","/cars"],["slot","end"],[3,"click",4,"ngIf"],[3,"ngModel","ngModelChange","ionChange"],["value","all"],["value","non_lues"],["slot","fixed",3,"ionRefresh"],[4,"ngIf"],["class","empty-state",4,"ngIf"],[3,"click"],["slot","icon-only","name","checkmark-done"],[4,"ngFor","ngForOf"],["button","",3,"click"],["size","large",3,"name","color"],[1,"date"],["slot","end","color","primary",4,"ngIf"],["side","end"],["color","danger",3,"click"],["slot","icon-only","name","trash"],["slot","end","color","primary"],[1,"empty-state"],["name","notifications-outline","size","large"]],template:function(e,i){1&e&&(t.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),t._UZ(3,"ion-back-button",1),t.qZA(),t.TgZ(4,"ion-title"),t._uU(5,"Notifications"),t.qZA(),t.TgZ(6,"ion-buttons",2),t.YNc(7,x,2,0,"ion-button",3),t.qZA()(),t.TgZ(8,"ion-toolbar")(9,"ion-segment",4),t.NdJ("ngModelChange",function(r){return i.selectedFilter=r})("ionChange",function(r){return i.filterChanged(r)}),t.TgZ(10,"ion-segment-button",5)(11,"ion-label"),t._uU(12,"Toutes"),t.qZA()(),t.TgZ(13,"ion-segment-button",6)(14,"ion-label"),t._uU(15),t.qZA()()()()(),t.TgZ(16,"ion-content")(17,"ion-refresher",7),t.NdJ("ionRefresh",function(r){return i.doRefresh(r)}),t._UZ(18,"ion-refresher-content"),t.qZA(),t.YNc(19,T,2,1,"ion-list",8),t.YNc(20,b,6,2,"div",9),t.qZA()),2&e&&(t.xp6(7),t.Q6J("ngIf",i.nombreNonLues>0),t.xp6(2),t.Q6J("ngModel",i.selectedFilter),t.xp6(6),t.hij("Non lues (",i.nombreNonLues,")"),t.xp6(4),t.Q6J("ngIf",i.filteredNotifications.length>0),t.xp6(1),t.Q6J("ngIf",0===i.filteredNotifications.length))},dependencies:[g.sg,g.O5,m.JJ,m.On,a.BJ,a.yp,a.YG,a.Sm,a.W2,a.Gu,a.gu,a.Ie,a.u8,a.IK,a.td,a.Q$,a.q_,a.nJ,a.Wo,a.cJ,a.GO,a.wd,a.sr,a.QI,a.oU],styles:["ion-item.unread[_ngcontent-%COMP%]{--background: var(--ion-color-light);border-left:3px solid var(--ion-color-primary)}ion-avatar[_ngcontent-%COMP%]{width:48px;height:48px;display:flex;align-items:center;justify-content:center;background:var(--ion-color-light);border-radius:50%}ion-avatar[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:28px}ion-label[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-weight:600;margin-bottom:4px}ion-label[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:14px;color:var(--ion-color-medium);margin-bottom:4px}ion-label[_ngcontent-%COMP%]   .date[_ngcontent-%COMP%]{font-size:12px;color:var(--ion-color-medium)}.empty-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:60px 20px;text-align:center}.empty-state[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:80px;color:var(--ion-color-medium);margin-bottom:20px}.empty-state[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:20px;font-weight:600;color:var(--ion-color-dark);margin-bottom:8px}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:14px;color:var(--ion-color-medium)}"]}),n})()}];let M=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[g.ez,m.u5,a.Pc,_.Bz.forChild(P)]}),n})()}}]);