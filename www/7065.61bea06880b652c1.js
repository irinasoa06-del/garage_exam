"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[7065],{7065:(E,d,s)=>{s.r(d),s.d(d,{CarDetailPageModule:()=>q});var g=s(6895),m=s(433),o=s(12),c=s(5861),f=s(506),v=s(3295),t=s(8256),_=s(2687);function x(n,a){if(1&n&&(t.TgZ(0,"div",12)(1,"span",13),t._uU(2,"Ann\xe9e:"),t.qZA(),t.TgZ(3,"span",14),t._uU(4),t.qZA()()),2&n){const e=t.oxw(2);t.xp6(4),t.Oqu(e.voiture.annee)}}function h(n,a){if(1&n&&(t.TgZ(0,"div",12)(1,"span",13),t._uU(2,"Couleur:"),t.qZA(),t.TgZ(3,"span",14),t._uU(4),t.qZA()()),2&n){const e=t.oxw(2);t.xp6(4),t.Oqu(e.voiture.couleur)}}function C(n,a){if(1&n&&(t.TgZ(0,"p"),t._uU(1),t.qZA()),2&n){const e=t.oxw().$implicit,r=t.oxw(3);t.xp6(1),t.hij(" Dur\xe9e: ",r.formatDuree(e.type_intervention.duree_secondes)," ")}}function Z(n,a){if(1&n&&t._UZ(0,"ion-progress-bar",25),2&n){const e=t.oxw().$implicit;t.Q6J("value",e.progression/100)}}function P(n,a){if(1&n&&(t.TgZ(0,"p",26),t._uU(1),t.qZA()),2&n){const e=t.oxw().$implicit;t.xp6(1),t.hij(" ",e.progression,"% ")}}function T(n,a){if(1&n&&(t.TgZ(0,"ion-item")(1,"ion-label")(2,"h3"),t._uU(3),t.qZA(),t.YNc(4,C,2,1,"p",6),t.TgZ(5,"p",21),t._uU(6),t.qZA()(),t.TgZ(7,"div",22)(8,"ion-badge",9),t._uU(9),t.qZA(),t.YNc(10,Z,1,1,"ion-progress-bar",23),t.YNc(11,P,2,1,"p",24),t.qZA()()),2&n){const e=a.$implicit,r=t.oxw(3);t.xp6(3),t.Oqu(e.type_intervention.nom),t.xp6(1),t.Q6J("ngIf",e.type_intervention.duree_secondes),t.xp6(2),t.hij("",e.type_intervention.prix_unitaire," Ar"),t.xp6(2),t.Q6J("color",r.getStatutColor(e.statut)),t.xp6(1),t.hij(" ",r.getStatutLabel(e.statut)," "),t.xp6(1),t.Q6J("ngIf","en_cours"===e.statut),t.xp6(1),t.Q6J("ngIf","en_cours"===e.statut)}}function y(n,a){if(1&n&&(t.TgZ(0,"ion-list"),t.YNc(1,T,12,7,"ion-item",20),t.qZA()),2&n){const e=t.oxw(2);t.xp6(1),t.Q6J("ngForOf",e.reparations)}}function M(n,a){1&n&&(t.TgZ(0,"div",27)(1,"p"),t._uU(2,"Aucune r\xe9paration en cours"),t.qZA()())}function O(n,a){if(1&n&&(t.TgZ(0,"div",28)(1,"div",29)(2,"span"),t._uU(3,"Total:"),t.qZA(),t.TgZ(4,"span",30),t._uU(5),t.qZA()()()),2&n){const e=t.oxw(2);t.xp6(5),t.hij("",e.montantTotal," Ar")}}function b(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"div",31)(1,"ion-button",32),t.NdJ("click",function(){t.CHM(e);const i=t.oxw(2);return t.KtG(i.payerReparations())}),t._UZ(2,"ion-icon",33),t._uU(3," Payer et r\xe9cup\xe9rer "),t.qZA()()}}function A(n,a){1&n&&(t.TgZ(0,"ion-card",34)(1,"ion-card-content")(2,"div",35),t._UZ(3,"ion-icon",36),t.TgZ(4,"p"),t._uU(5,"Votre voiture est en attente de prise en charge"),t.qZA()()()())}function I(n,a){1&n&&(t.TgZ(0,"ion-card",37)(1,"ion-card-content")(2,"div",35),t._UZ(3,"ion-icon",38),t.TgZ(4,"p"),t._uU(5,"Vos r\xe9parations sont en cours. Vous recevrez une notification quand elles seront termin\xe9es."),t.qZA()()()())}function D(n,a){if(1&n&&(t.TgZ(0,"div")(1,"ion-card")(2,"ion-card-header")(3,"div",7),t._UZ(4,"ion-icon",8),t.TgZ(5,"div")(6,"ion-card-title"),t._uU(7),t.qZA(),t.TgZ(8,"ion-card-subtitle"),t._uU(9),t.qZA()(),t.TgZ(10,"ion-badge",9),t._uU(11),t.qZA()()(),t.TgZ(12,"ion-card-content")(13,"div",10),t.YNc(14,x,5,1,"div",11),t.YNc(15,h,5,1,"div",11),t.TgZ(16,"div",12)(17,"span",13),t._uU(18,"Ajout\xe9e le:"),t.qZA(),t.TgZ(19,"span",14),t._uU(20),t.ALo(21,"date"),t.qZA()()()()(),t.TgZ(22,"ion-card")(23,"ion-card-header")(24,"ion-card-title"),t._uU(25,"R\xe9parations"),t.qZA()(),t.TgZ(26,"ion-card-content"),t.YNc(27,y,2,1,"ion-list",6),t.YNc(28,M,3,0,"div",15),t.YNc(29,O,6,1,"div",16),t.qZA()(),t.YNc(30,b,4,0,"div",17),t.YNc(31,A,6,0,"ion-card",18),t.YNc(32,I,6,0,"ion-card",19),t.qZA()),2&n){const e=t.oxw();t.xp6(7),t.AsE("",e.voiture.marque," ",e.voiture.modele,""),t.xp6(2),t.Oqu(e.voiture.immatriculation),t.xp6(1),t.Q6J("color",e.getStatutColor(e.voiture.statut)),t.xp6(1),t.hij(" ",e.getStatutLabel(e.voiture.statut)," "),t.xp6(3),t.Q6J("ngIf",e.voiture.annee),t.xp6(1),t.Q6J("ngIf",e.voiture.couleur),t.xp6(5),t.Oqu(t.xi3(21,14,e.voiture.date_ajout,"dd/MM/yyyy")),t.xp6(7),t.Q6J("ngIf",e.reparations.length>0),t.xp6(1),t.Q6J("ngIf",0===e.reparations.length),t.xp6(1),t.Q6J("ngIf",e.reparations.length>0),t.xp6(1),t.Q6J("ngIf","prete"===e.voiture.statut),t.xp6(1),t.Q6J("ngIf","en_attente"===e.voiture.statut),t.xp6(1),t.Q6J("ngIf","en_reparation"===e.voiture.statut)}}const U=[{path:"",component:(()=>{class n{constructor(e,r,i,l,p,u){this.route=e,this.router=r,this.voitureService=i,this.reparationService=l,this.loadingController=p,this.alertController=u,this.reparations=[],this.montantTotal=0}ngOnInit(){this.voitureId=parseInt(this.route.snapshot.paramMap.get("id")||"0"),this.voitureId&&(this.loadVoitureDetails(),this.loadReparations())}loadVoitureDetails(){var e=this;return(0,c.Z)(function*(){const r=yield e.loadingController.create({message:"Chargement..."});var i;yield r.present(),e.voitureService.getVoitureById(e.voitureId).subscribe({next:i=>{e.voiture=i,r.dismiss()},error:(i=(0,c.Z)(function*(l){r.dismiss(),yield(yield e.alertController.create({header:"Erreur",message:"Impossible de charger les d\xe9tails de la voiture",buttons:["OK"]})).present(),e.router.navigate(["/cars"])}),function(p){return i.apply(this,arguments)})})})()}loadReparations(){var e=this;return(0,c.Z)(function*(){e.reparationService.getReparationsByVoiture(e.voitureId).subscribe({next:r=>{e.reparations=r,e.calculerMontantTotal()},error:r=>{console.error("Erreur chargement r\xe9parations:",r)}})})()}calculerMontantTotal(){this.montantTotal=this.reparations.reduce((e,r)=>{var i;return e+((null===(i=r.type_intervention)||void 0===i?void 0:i.prix_unitaire)||0)},0)}getStatutColor(e){switch(e){case"en_attente":return"warning";case"en_cours":return"primary";case"terminee":return"success";default:return"medium"}}getStatutLabel(e){switch(e){case"en_attente":return"En attente";case"en_cours":return"En cours";case"terminee":return"Termin\xe9e";default:return e}}formatDuree(e){const r=Math.floor(e/3600),i=Math.floor(e%3600/60);return r>0?`${r}h ${i}min`:`${i}min`}payerReparations(){var e=this;return(0,c.Z)(function*(){e.reparations.every(i=>"terminee"===i.statut)?e.router.navigate(["/repairs/payment",e.voitureId]):yield(yield e.alertController.create({header:"R\xe9parations non termin\xe9es",message:"Toutes les r\xe9parations doivent \xeatre termin\xe9es avant de pouvoir payer",buttons:["OK"]})).present()})()}supprimerVoiture(){var e=this;return(0,c.Z)(function*(){var r,i,p;yield(yield e.alertController.create({header:"Confirmer la suppression",message:`Voulez-vous vraiment supprimer ${null===(r=e.voiture)||void 0===r?void 0:r.marque} ${null===(i=e.voiture)||void 0===i?void 0:i.modele} ?`,buttons:[{text:"Annuler",role:"cancel"},{text:"Supprimer",role:"destructive",handler:(p=(0,c.Z)(function*(){const u=yield e.loadingController.create({message:"Suppression..."});var J;yield u.present(),e.voitureService.deleteVoiture(e.voitureId).subscribe({next:()=>{u.dismiss(),e.router.navigate(["/cars"])},error:(J=(0,c.Z)(function*(w){u.dismiss(),yield(yield e.alertController.create({header:"Erreur",message:"Impossible de supprimer la voiture",buttons:["OK"]})).present()}),function(Y){return J.apply(this,arguments)})})}),function(){return p.apply(this,arguments)})}]})).present()})()}doRefresh(e){this.loadVoitureDetails(),this.reparationService.getReparationsByVoiture(this.voitureId).subscribe({next:r=>{this.reparations=r,this.calculerMontantTotal(),e.target.complete()},error:()=>{e.target.complete()}})}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(_.gz),t.Y36(_.F0),t.Y36(f.E),t.Y36(v.L),t.Y36(o.HT),t.Y36(o.Br))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-car-detail"]],decls:13,vars:1,consts:[["slot","start"],["defaultHref","/cars"],["slot","end"],[3,"click"],["slot","icon-only","name","trash","color","danger"],["slot","fixed",3,"ionRefresh"],[4,"ngIf"],[1,"car-header"],["name","car-sport","size","large","color","primary"],[3,"color"],[1,"car-info"],["class","info-item",4,"ngIf"],[1,"info-item"],[1,"label"],[1,"value"],["class","empty-state",4,"ngIf"],["class","total-section",4,"ngIf"],["class","action-buttons",4,"ngIf"],["color","warning",4,"ngIf"],["color","primary",4,"ngIf"],[4,"ngFor","ngForOf"],[1,"price"],["slot","end",1,"reparation-status"],["color","primary",3,"value",4,"ngIf"],["class","progression-text",4,"ngIf"],["color","primary",3,"value"],[1,"progression-text"],[1,"empty-state"],[1,"total-section"],[1,"total-line"],[1,"total-amount"],[1,"action-buttons"],["expand","block","color","success",3,"click"],["slot","start","name","card"],["color","warning"],[1,"status-message"],["name","time"],["color","primary"],["name","construct"]],template:function(e,r){1&e&&(t.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),t._UZ(3,"ion-back-button",1),t.qZA(),t.TgZ(4,"ion-title"),t._uU(5,"D\xe9tails"),t.qZA(),t.TgZ(6,"ion-buttons",2)(7,"ion-button",3),t.NdJ("click",function(){return r.supprimerVoiture()}),t._UZ(8,"ion-icon",4),t.qZA()()()(),t.TgZ(9,"ion-content")(10,"ion-refresher",5),t.NdJ("ionRefresh",function(l){return r.doRefresh(l)}),t._UZ(11,"ion-refresher-content"),t.qZA(),t.YNc(12,D,33,17,"div",6),t.qZA()),2&e&&(t.xp6(12),t.Q6J("ngIf",r.voiture))},dependencies:[g.sg,g.O5,o.yp,o.YG,o.Sm,o.PM,o.FN,o.Zi,o.tO,o.Dq,o.W2,o.Gu,o.gu,o.Ie,o.Q$,o.q_,o.X7,o.nJ,o.Wo,o.wd,o.sr,o.oU,g.uU],styles:[".car-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px}.car-header[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:48px}.car-header[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{flex:1}.car-info[_ngcontent-%COMP%]{margin-top:16px}.car-info[_ngcontent-%COMP%]   .info-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px solid var(--ion-color-light)}.car-info[_ngcontent-%COMP%]   .info-item[_ngcontent-%COMP%]:last-child{border-bottom:none}.car-info[_ngcontent-%COMP%]   .info-item[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{color:var(--ion-color-medium);font-weight:500}.car-info[_ngcontent-%COMP%]   .info-item[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{font-weight:600}.price[_ngcontent-%COMP%]{color:var(--ion-color-primary);font-weight:600;margin-top:4px}.reparation-status[_ngcontent-%COMP%]{text-align:right;min-width:100px}.reparation-status[_ngcontent-%COMP%]   ion-progress-bar[_ngcontent-%COMP%]{margin-top:8px}.reparation-status[_ngcontent-%COMP%]   .progression-text[_ngcontent-%COMP%]{font-size:12px;color:var(--ion-color-medium);margin-top:4px}.total-section[_ngcontent-%COMP%]{margin-top:20px;padding-top:16px;border-top:2px solid var(--ion-color-light)}.total-section[_ngcontent-%COMP%]   .total-line[_ngcontent-%COMP%]{display:flex;justify-content:space-between;font-size:20px;font-weight:700}.total-section[_ngcontent-%COMP%]   .total-line[_ngcontent-%COMP%]   .total-amount[_ngcontent-%COMP%]{color:var(--ion-color-primary)}.action-buttons[_ngcontent-%COMP%]{padding:16px}.action-buttons[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{font-weight:600;height:48px}.status-message[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;color:#fff}.status-message[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:32px}.status-message[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;flex:1}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:20px;color:var(--ion-color-medium)}"]}),n})()}];let q=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[g.ez,m.u5,o.Pc,_.Bz.forChild(U)]}),n})()}}]);