"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[8370],{8370:(M,f,a)=>{a.r(f),a.d(f,{RepairPaymentPageModule:()=>A});var d=a(6895),c=a(433),r=a(12),p=a(5861),h=a(506),P=a(3295),y=a(5384),e=a(8256);let _=(()=>{class n{constructor(t){this.api=t}effectuerPaiement(t){return this.api.post("paiements",t)}getMesPaiements(){return this.api.get("commandes")}getPaiementById(t){return this.api.get(`commandes/${t}`)}getPaiementsByVoiture(t){return this.api.get(`voitures/${t}/commandes`)}}return n.\u0275fac=function(t){return new(t||n)(e.LFG(y.s))},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var g=a(2687);function x(n,s){if(1&n&&(e.TgZ(0,"ion-item")(1,"ion-label")(2,"h3"),e._uU(3),e.qZA(),e.TgZ(4,"p"),e._uU(5),e.qZA()(),e.TgZ(6,"ion-note",18),e._uU(7),e.qZA()()),2&n){const t=s.$implicit;e.xp6(3),e.Oqu(t.type_intervention.nom),e.xp6(2),e.Oqu(t.type_intervention.description),e.xp6(2),e.hij(" ",t.type_intervention.prix_unitaire," Ar ")}}function Z(n,s){if(1&n&&(e.TgZ(0,"ion-item")(1,"ion-label"),e._uU(2),e.qZA(),e._UZ(3,"ion-radio",19),e.qZA()),2&n){const t=s.$implicit;e.xp6(2),e.Oqu(t.label),e.xp6(1),e.Q6J("value",t.value)}}function b(n,s){if(1&n){const t=e.EpF();e.TgZ(0,"div")(1,"ion-card")(2,"ion-card-header")(3,"ion-card-title"),e._UZ(4,"ion-icon",4),e._uU(5),e.qZA(),e.TgZ(6,"ion-card-subtitle"),e._uU(7),e.qZA()()(),e.TgZ(8,"ion-card")(9,"ion-card-header")(10,"ion-card-title"),e._uU(11,"R\xe9parations effectu\xe9es"),e.qZA()(),e.TgZ(12,"ion-card-content")(13,"ion-list"),e.YNc(14,x,8,3,"ion-item",5),e.qZA(),e.TgZ(15,"div",6)(16,"span",7),e._uU(17,"Total \xe0 payer:"),e.qZA(),e.TgZ(18,"span",8),e._uU(19),e.qZA()()()(),e.TgZ(20,"ion-card")(21,"ion-card-header")(22,"ion-card-title"),e._uU(23,"Mode de paiement"),e.qZA()(),e.TgZ(24,"ion-card-content")(25,"form",9)(26,"ion-radio-group",10),e.YNc(27,Z,4,2,"ion-item",5),e.qZA()()()(),e.TgZ(28,"ion-card",11)(29,"ion-card-content")(30,"div",12),e._UZ(31,"ion-icon",13),e.TgZ(32,"p"),e._uU(33,"Apr\xe8s paiement, votre v\xe9hicule sera pr\xeat \xe0 \xeatre r\xe9cup\xe9r\xe9. Le slot garage sera lib\xe9r\xe9."),e.qZA()()()(),e.TgZ(34,"div",14)(35,"ion-button",15),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.annuler())}),e._uU(36," Annuler "),e.qZA(),e.TgZ(37,"ion-button",16),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.confirmerPaiement())}),e._UZ(38,"ion-icon",17),e._uU(39),e.qZA()()()}if(2&n){const t=e.oxw();e.xp6(5),e.AsE(" ",t.voiture.marque," ",t.voiture.modele," "),e.xp6(2),e.Oqu(t.voiture.immatriculation),e.xp6(7),e.Q6J("ngForOf",t.reparations),e.xp6(5),e.hij("",t.montantTotal," Ar"),e.xp6(6),e.Q6J("formGroup",t.paymentForm),e.xp6(2),e.Q6J("ngForOf",t.modesPaiement),e.xp6(10),e.Q6J("disabled",t.paymentForm.invalid),e.xp6(2),e.hij(" Payer ",t.montantTotal," Ar ")}}const T=[{path:"",component:(()=>{class n{constructor(t,i,o,l,u,m,v,C){this.route=t,this.router=i,this.formBuilder=o,this.voitureService=l,this.reparationService=u,this.paiementService=m,this.loadingController=v,this.alertController=C,this.reparations=[],this.montantTotal=0,this.modesPaiement=[{value:"especes",label:"Esp\xe8ces"},{value:"carte",label:"Carte bancaire"},{value:"mobile_money",label:"Mobile Money"},{value:"virement",label:"Virement bancaire"}],this.paymentForm=this.formBuilder.group({mode_paiement:["especes",c.kI.required]})}ngOnInit(){this.voitureId=parseInt(this.route.snapshot.paramMap.get("id")||"0"),this.voitureId&&this.loadData()}loadData(){var t=this;return(0,p.Z)(function*(){const i=yield t.loadingController.create({message:"Chargement..."});var o;yield i.present(),t.voitureService.getVoitureById(t.voitureId).subscribe({next:o=>{t.voiture=o},error:o=>{console.error("Erreur chargement voiture:",o)}}),t.reparationService.getReparationsByVoiture(t.voitureId).subscribe({next:o=>{t.reparations=o.filter(l=>"terminee"===l.statut),t.calculerMontantTotal(),i.dismiss(),0===t.reparations.length&&t.showErrorAndGoBack("Aucune r\xe9paration termin\xe9e \xe0 payer")},error:(o=(0,p.Z)(function*(l){i.dismiss(),t.showErrorAndGoBack("Impossible de charger les r\xe9parations")}),function(u){return o.apply(this,arguments)})})})()}calculerMontantTotal(){this.montantTotal=this.reparations.reduce((t,i)=>{var o;return t+((null===(o=i.type_intervention)||void 0===o?void 0:o.prix_unitaire)||0)},0)}showErrorAndGoBack(t){var i=this;return(0,p.Z)(function*(){yield(yield i.alertController.create({header:"Erreur",message:t,buttons:[{text:"OK",handler:()=>{i.router.navigate(["/cars",i.voitureId])}}]})).present()})()}confirmerPaiement(){var t=this;return(0,p.Z)(function*(){t.paymentForm.invalid||(yield(yield t.alertController.create({header:"Confirmer le paiement",message:`Montant \xe0 payer: ${t.montantTotal} Ar<br>Mode: ${t.getModePaiementLabel(t.paymentForm.value.mode_paiement)}`,buttons:[{text:"Annuler",role:"cancel"},{text:"Confirmer",handler:()=>{t.effectuerPaiement()}}]})).present())})()}effectuerPaiement(){var t=this;return(0,p.Z)(function*(){const i=yield t.loadingController.create({message:"Traitement du paiement..."});yield i.present();const o={voiture_id:t.voitureId,mode_paiement:t.paymentForm.value.mode_paiement,reparation_ids:t.reparations.map(l=>l.reparation_id)};var l;t.paiementService.effectuerPaiement(o).subscribe({next:(l=(0,p.Z)(function*(u){yield i.dismiss(),yield(yield t.alertController.create({header:"Paiement r\xe9ussi !",message:`Votre paiement de ${t.montantTotal} Ar a \xe9t\xe9 effectu\xe9 avec succ\xe8s.<br><br>Num\xe9ro de transaction: ${u.transaction_id||"N/A"}`,buttons:[{text:"OK",handler:()=>{t.router.navigate(["/cars"])}}]})).present()}),function(m){return l.apply(this,arguments)}),error:function(){var l=(0,p.Z)(function*(u){var m;yield i.dismiss(),yield(yield t.alertController.create({header:"\xc9chec du paiement",message:(null===(m=u.error)||void 0===m?void 0:m.message)||"Une erreur est survenue lors du paiement",buttons:["OK"]})).present()});return function(m){return l.apply(this,arguments)}}()})})()}getModePaiementLabel(t){const i=this.modesPaiement.find(o=>o.value===t);return i?i.label:t}annuler(){this.router.navigate(["/cars",this.voitureId])}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(g.gz),e.Y36(g.F0),e.Y36(c.qu),e.Y36(h.E),e.Y36(P.L),e.Y36(_),e.Y36(r.HT),e.Y36(r.Br))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-repair-payment"]],decls:8,vars:2,consts:[["slot","start"],[3,"defaultHref"],[1,"ion-padding"],[4,"ngIf"],["name","car-sport"],[4,"ngFor","ngForOf"],[1,"total-section"],[1,"total-label"],[1,"total-amount"],[3,"formGroup"],["formControlName","mode_paiement"],["color","warning"],[1,"warning-message"],["name","information-circle"],[1,"action-buttons"],["expand","block","fill","outline",3,"click"],["expand","block","color","success",3,"disabled","click"],["slot","start","name","card"],["slot","end","color","primary"],["slot","start",3,"value"]],template:function(t,i){1&t&&(e.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),e._UZ(3,"ion-back-button",1),e.qZA(),e.TgZ(4,"ion-title"),e._uU(5,"Paiement"),e.qZA()()(),e.TgZ(6,"ion-content",2),e.YNc(7,b,40,9,"div",3),e.qZA()),2&t&&(e.xp6(3),e.Q6J("defaultHref","/cars/"+i.voitureId),e.xp6(4),e.Q6J("ngIf",i.voiture))},dependencies:[d.sg,d.O5,c._Y,c.JJ,c.JL,c.sg,c.u,r.YG,r.Sm,r.PM,r.FN,r.Zi,r.tO,r.Dq,r.W2,r.Gu,r.gu,r.Ie,r.Q$,r.q_,r.uN,r.B7,r.se,r.wd,r.sr,r.U5,r.QI,r.oU],styles:["ion-card-title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}ion-card-title[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:24px}.total-section[_ngcontent-%COMP%]{margin-top:20px;padding-top:16px;border-top:2px solid var(--ion-color-light);display:flex;justify-content:space-between;align-items:center}.total-section[_ngcontent-%COMP%]   .total-label[_ngcontent-%COMP%]{font-size:18px;font-weight:600}.total-section[_ngcontent-%COMP%]   .total-amount[_ngcontent-%COMP%]{font-size:28px;font-weight:700;color:var(--ion-color-success)}ion-radio-group[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{--padding-start: 0;margin-bottom:8px}.warning-message[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;color:var(--ion-text-color)}.warning-message[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:32px;flex-shrink:0}.warning-message[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;flex:1}.action-buttons[_ngcontent-%COMP%]{display:flex;gap:12px;margin-top:24px;padding:0 16px 16px}.action-buttons[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{flex:1;height:48px;font-weight:600}"]}),n})()}];let A=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[d.ez,c.u5,c.UX,r.Pc,g.Bz.forChild(T)]}),n})()}}]);